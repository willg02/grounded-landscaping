// Prisma schema for Grounded Landscaping
// Database: PostgreSQL (Neon)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User accounts for employees and admins
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  name          String
  phone         String?
  role          String    @default("employee") // admin, manager, employee
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // Relations
  assignedJobs  Job[]     @relation("AssignedEmployee")
  createdJobs   Job[]     @relation("CreatedBy")
  invoices      Invoice[] @relation("CreatedByUser")
  notes         Note[]
}

// Client/Customer information
model Client {
  id            String    @id @default(cuid())
  firstName     String
  lastName      String
  email         String?
  phone         String
  address       String
  city          String
  state         String
  zipCode       String
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // Relations
  jobs          Job[]
  invoices      Invoice[]
}

// Job/Project tracking
model Job {
  id            String    @id @default(cuid())
  title         String
  description   String?
  serviceType   String    // demo, plant_installation, mulch, general_install
  status        String    @default("pending") // pending, scheduled, in_progress, completed, cancelled
  priority      String    @default("normal") // low, normal, high, urgent
  
  // Scheduling
  scheduledDate DateTime?
  scheduledTime String?
  estimatedHours Float?
  actualHours   Float?
  
  // Location (can differ from client address)
  jobAddress    String
  jobCity       String
  jobState      String
  jobZipCode    String
  
  // Pricing
  estimatedCost Float?
  actualCost    Float?
  
  // Timestamps
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  completedAt   DateTime?
  
  // Relations
  clientId      String
  client        Client    @relation(fields: [clientId], references: [id])
  assignedToId  String?
  assignedTo    User?     @relation("AssignedEmployee", fields: [assignedToId], references: [id])
  createdById   String
  createdBy     User      @relation("CreatedBy", fields: [createdById], references: [id])
  invoice       Invoice?
  materials     Material[]
  notes         Note[]
}

// Invoice management
model Invoice {
  id            String    @id @default(cuid())
  invoiceNumber String    @unique
  status        String    @default("draft") // draft, sent, paid, overdue, cancelled
  
  // Amounts
  subtotal      Float
  tax           Float     @default(0)
  total         Float
  amountPaid    Float     @default(0)
  
  // Dates
  issueDate     DateTime  @default(now())
  dueDate       DateTime
  paidDate      DateTime?
  
  // Details
  notes         String?
  
  // Timestamps
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // Relations
  clientId      String
  client        Client    @relation(fields: [clientId], references: [id])
  jobId         String?   @unique
  job           Job?      @relation(fields: [jobId], references: [id])
  createdById   String
  createdBy     User      @relation("CreatedByUser", fields: [createdById], references: [id])
  lineItems     LineItem[]
}

// Invoice line items
model LineItem {
  id            String    @id @default(cuid())
  description   String
  quantity      Float
  unitPrice     Float
  total         Float
  
  // Relations
  invoiceId     String
  invoice       Invoice   @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
}

// Materials tracking for jobs
model Material {
  id            String    @id @default(cuid())
  name          String
  quantity      Float
  unit          String    // yards, bags, each, etc.
  cost          Float?
  
  // Relations
  jobId         String
  job           Job       @relation(fields: [jobId], references: [id], onDelete: Cascade)
}

// Notes for jobs and general
model Note {
  id            String    @id @default(cuid())
  content       String
  createdAt     DateTime  @default(now())
  
  // Relations
  jobId         String?
  job           Job?      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  userId        String
  user          User      @relation(fields: [userId], references: [id])
}

// Service types catalog
model Service {
  id            String    @id @default(cuid())
  name          String
  slug          String    @unique
  description   String
  basePrice     Float?
  priceUnit     String?   // per_hour, per_sqft, per_yard, flat_rate
  isActive      Boolean   @default(true)
}

// Contact form submissions from website
model ContactSubmission {
  id            String    @id @default(cuid())
  name          String
  email         String
  phone         String?
  service       String?
  message       String
  status        String    @default("new") // new, contacted, converted, closed
  createdAt     DateTime  @default(now())
}

// ─── Plant & Cultivar Catalog ───────────────────────────────────────────────

model Plant {
  id              String    @id @default(cuid())

  // Identification
  commonName      String
  scientificName  String?
  genus           String?
  species         String?
  cultivar        String?   // e.g. 'Bloodgood', 'Emerald Green'
  variety         String?   // botanical variety if different from cultivar
  trademark       String?   // trademarked marketing name (e.g. Endless Summer®)

  // Classification
  plantType       String    // tree, shrub, perennial, annual, grass, groundcover, vine, fern, succulent, bulb, aquatic
  category        String?   // native, ornamental, edible, pollinator, shade, specimen, etc.
  tags            String[]  // flexible labels: deer-resistant, drought-tolerant, fragrant, low-maintenance, etc.

  // Size & Growth
  matureHeightMin Float?    // feet
  matureHeightMax Float?
  matureSpreadMin Float?    // feet
  matureSpreadMax Float?
  growthRate      String?   // slow, moderate, fast

  // Growing Conditions
  usdaZoneMin     Int?      // e.g. 5
  usdaZoneMax     Int?      // e.g. 9
  sunExposure     String[]  // full-sun, part-sun, part-shade, full-shade
  waterNeeds      String?   // low, moderate, high
  soilType        String[]  // clay, loam, sand, well-drained, moist, acidic, alkaline
  soilPH          String?   // acidic, neutral, alkaline

  // Visual / Design Attributes
  flowerColor     String[]  // white, pink, red, etc.
  foliageColor    String[]  // green, blue-green, burgundy, variegated, etc.
  fallColor       String[]
  bloomSeason     String[]  // early-spring, spring, late-spring, summer, fall, winter
  texture         String?   // fine, medium, coarse
  form            String?   // rounded, columnar, pyramidal, weeping, spreading, vase, irregular
  evergreenOrDecid String?  // evergreen, semi-evergreen, deciduous

  // Practical Info
  nativeTo        String?   // region or geographic origin
  pollinators     String[]  // bees, butterflies, hummingbirds, etc.
  wildlifeValue   String[]  // birds, deer-browse, etc.
  resistances     String[]  // deer, rabbit, disease, drought, salt, etc.
  toxicity        String?   // non-toxic, toxic-to-pets, toxic-to-humans

  // Business / Inventory
  commonSizes     String[]  // 1-gal, 3-gal, 5-gal, 7-gal, 15-gal, B&B, bare-root
  avgCost         Float?    // typical wholesale cost
  retailPrice     Float?    // typical retail / install price
  supplier        String?
  availability    String?   // common, seasonal, specialty, rare
  notes           String?   // free-form internal notes
  imageUrl        String?

  // Design usage
  designUses      String[]  // foundation, border, accent, mass-planting, hedge, screen, specimen, rain-garden, container, slope-stabilization

  // Meta
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@unique([scientificName, cultivar])
  @@index([plantType])
  @@index([commonName])
}
